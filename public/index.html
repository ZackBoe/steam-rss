<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width">

  <title>Owned Steam Game RSS Feeds</title>

  <script type="module">
    document.documentElement.classList.remove('no-js');
    document.documentElement.classList.add('js');
  </script>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/tofsjonas/sortable@3.2.2/sortable-base.min.css">
  <link rel="stylesheet" href="/style.css">

  <meta name="description" content="Generate an OPML for RSS Feeds from your owned Steam games. Get updates from your owned Steam games in your favorite RSS reader.">
  <meta property="og:title" content="Owned Steam Games RSS Feeds">
  <meta property="og:description" content="Generate an OPML for RSS Feeds from your owned Steam games. Get updates from your owned Steam games in your favorite RSS reader.">
  <meta property="og:locale" content="en_US">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://steam-rss.zackboe.hm">
  <meta property="og:image" content="https://steam-rss.zackboe.hm/steam-opml-social.png">
  <link rel="canonical" href="https://steam-rss.zackboe.hm">

  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“‘</text></svg>">
  <link rel="icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <meta name="theme-color" content="#1b2838">
</head>

<body>

  <main id="main">
    <h1>Owned Steam Game RSS Feeds</h1>
    <h2>Subscribe to news feeds for your Steam games in your reader of choice!</h2>

    <p>Generates an .opml of <a href="https://aboutfeeds.com/">RSS feeds</a> for your currently owned Steam games.</p>
    <p>This will not work if your <a href="https://help.steampowered.com/en/faqs/view/588C-C67D-0251-C276"><strong>profile</strong> or <strong>game details</strong> are not public</a> or on <a href="https://help.steampowered.com/en/faqs/view/1150-C06F-4D62-4966">games you've <strong>marked as private</strong></a>.</p>

    <noscript><p>If you enable JavaScript, you'll have more options of which games from your library to include or exclude in the generated .opml, as well as exporting/importing of your settings. Without JS, you'll just receive the full .opml file.</p></noscript>

    <form name="form" action="/.netlify/functions/generateOPML">
      <label for="steamURL">Steam Profile URL:</label>
      <div>
        <input id="steamURL" name="steamURL" placeholder="https://steamcommunity.com/id/gabelogannewell"/>
        <button type="submit">Generate OPML</button>
      </div>
      <div class="options no-js">
      <label for="includeFree">Include free games? <input type="checkbox" name="includeFree" id="includeFree"></label>
      <label for="includeUnplayed">Include unplayed games? <input type="checkbox" checked name="includeUnplayed" id="includeUnplayed"></label>
      </div>
    </form>

    <section id="result"></section>
  </main>

  <section class="extension">You can also install my <a href="https://addons.mozilla.org/en-US/firefox/addon/steam-rss-ext/?utm_source=steamrssopml">Firefox Extension</a> to add RSS links and meta tags to Steam store pages!</section>
  <section class="actions"></section>
  <table class="sortable"></table>

  <footer class="zack">
  <div class="zack_header">
    <div class="zack_z">Z</div>
    <div class="zack_boehm"><span>Zack</span><span>Boehm</div>
  </div>
  <div class="zack_icons">
    <a href="https://zackboe.hm">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm7.5-6.923c-.67.204-1.335.82-1.887 1.855A7.97 7.97 0 0 0 5.145 4H7.5V1.077zM4.09 4a9.267 9.267 0 0 1 .64-1.539 6.7 6.7 0 0 1 .597-.933A7.025 7.025 0 0 0 2.255 4H4.09zm-.582 3.5c.03-.877.138-1.718.312-2.5H1.674a6.958 6.958 0 0 0-.656 2.5h2.49zM4.847 5a12.5 12.5 0 0 0-.338 2.5H7.5V5H4.847zM8.5 5v2.5h2.99a12.495 12.495 0 0 0-.337-2.5H8.5zM4.51 8.5a12.5 12.5 0 0 0 .337 2.5H7.5V8.5H4.51zm3.99 0V11h2.653c.187-.765.306-1.608.338-2.5H8.5zM5.145 12c.138.386.295.744.468 1.068.552 1.035 1.218 1.65 1.887 1.855V12H5.145zm.182 2.472a6.696 6.696 0 0 1-.597-.933A9.268 9.268 0 0 1 4.09 12H2.255a7.024 7.024 0 0 0 3.072 2.472zM3.82 11a13.652 13.652 0 0 1-.312-2.5h-2.49c.062.89.291 1.733.656 2.5H3.82zm6.853 3.472A7.024 7.024 0 0 0 13.745 12H11.91a9.27 9.27 0 0 1-.64 1.539 6.688 6.688 0 0 1-.597.933zM8.5 12v2.923c.67-.204 1.335-.82 1.887-1.855.173-.324.33-.682.468-1.068H8.5zm3.68-1h2.146c.365-.767.594-1.61.656-2.5h-2.49a13.65 13.65 0 0 1-.312 2.5zm2.802-3.5a6.959 6.959 0 0 0-.656-2.5H12.18c.174.782.282 1.623.312 2.5h2.49zM11.27 2.461c.247.464.462.98.64 1.539h1.835a7.024 7.024 0 0 0-3.072-2.472c.218.284.418.598.597.933zM10.855 4a7.966 7.966 0 0 0-.468-1.068C9.835 1.897 9.17 1.282 8.5 1.077V4h2.355z"/></svg>
    </a>
    <a rel="me" href="https://mastodon.social/@zackboehm">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z"/></svg>
    </a>
    <a href="https://github.com/zackboe/steam-rss">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg>
    </a>
  </div>
</footer>
<script src="https://cdn.jsdelivr.net/gh/tofsjonas/sortable@3.2.2/sortable.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/tofsjonas/sortable@3.2.2/sortable.a11y.min.js"></script>
<script defer data-domain="steam-rss.zackboe.hm" src="https://s.zackboe.hm/js/script.js"></script>
<script>window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) }</script>
<script>

  document.querySelector('form').addEventListener('submit', (e) => {
    e.preventDefault()
    const steamURL = form.steamURL.value
    const result = document.querySelector('#result')
    result.innerHTML = '<p>Working on it...</p>'
    const userURL = /(?:http|https):\/\/(steamcommunity\.com)\/(profiles|id)\/(.*)/i.exec(steamURL)
    if (userURL?.[1] == 'steamcommunity.com') {
      
      fetch(`/.netlify/functions/generateOPML`, {
        method: 'post',
        body: JSON.stringify({ steamURL: steamURL, includeFree: form.includeFree.checked, includeUnplayed: form.includeUnplayed.checked }),
        headers: { 'Content-Type': 'application/json' }
      })
      .then(resp => resp.json())
      .then(body => {
        console.log(body)
        if(!body.error) {

          document.querySelector('.extension').style.display = 'none'
          const main = document.querySelector('main')
          main.classList.add('result')
          main.innerHTML = `
          <div class="opml">
            <img src="${body.profile.avatar}">
            <div>
              <h1>Hey, ${body.profile.name}!</h1>
              <p>With your options, Steam returned ${body.count} games!</p>
            </div>
          </div>
          <p>You can <a download="steam-updates.opml" href="data:text/xml;charset=utf-8,${encodeURIComponent(body.opml)}">download the generated .opml</a> and import it into your <a href="https://aboutfeeds.com/">favorite RSS reader</a>.</p>
          <p>If there's games you don't want to see in your reader, you can use the table below to build a further customized OPML file. Sort by clicking on the table headers and export/import your excluded games to keep your settings between reruns of this tool.</p>
          `

          document.querySelector('.actions').innerHTML = `
          <div>
            <div>
              <button data-downloadFull><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4M12 18v-6M9 15l3 3 3-3"/></svg> Download full OPML with all ${body.count} games</button>
              <button data-generate><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24"><path d="M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v2"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><circle cx="6" cy="14" r="3"/><path d="M6 10v1M6 17v1M10 14H9M3 14H2M9 11l-.88.88M3.88 16.12 3 17M9 17l-.88-.88M3.88 11.88 3 11"/></svg> Generate OPML without <span>0</span> excluded games</button>
              <button data-import><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24"><path d="M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v4"/><path d="M14 2v4a2 2 0 0 0 2 2h4M2 15h10M9 18l3-3-3-3"/></svg> Import Excluded Games</button>
              <button data-export><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24"><path d="M14 2v4a2 2 0 0 0 2 2h4M4 7V4a2 2 0 0 1 2-2 2 2 0 0 0-2 2"/><path d="M4.063 20.999a2 2 0 0 0 2 1L18 22a2 2 0 0 0 2-2V7l-5-5H6M5 11l-3 3"/><path d="m5 17-3-3h10"/></svg> Save Excluded Games</button>
            </div>
            <div>
              <button data-checkAll><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="m9 12 2 2 4-4"/></svg> Include all games</a>
              <button data-uncheckAll><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><path d="m15 9-6 6M9 9l6 6"/></svg> Exclude all games</a>
            </div>
          </div>
          <a href="#main"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="m16 12-4-4-4 4M12 16V8"/></svg></a>
          `

          document.querySelector('table').innerHTML = body.table
          document.querySelectorAll('table input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('click', (e) => {
              if(e.target.checked) {
                e.target.parentElement.dataset.sort = "1"
                document.querySelector('[data-generate] span').innerText = document.querySelectorAll('tbody input[type="checkbox"]:not(:checked').length
              }
              else {
                e.target.parentElement.dataset.sort = "0"
                document.querySelector('[data-generate] span').innerText = document.querySelectorAll('tbody input[type="checkbox"]:not(:checked)').length
              }
            })
          })

          document.querySelector('[data-downloadFull]').addEventListener('click', () => download(`data:text/xml;charset=utf-8,${encodeURIComponent(body.opml)}`, 'steam-updates.opml'))
          document.querySelector('[data-generate]').addEventListener('click', downloadFilteredOpml)
          document.querySelector('[data-checkAll]').addEventListener('click', checkAll)
          document.querySelector('[data-uncheckAll]').addEventListener('click', uncheckAll)
          document.querySelector('[data-export]').addEventListener('click', exportFilterList)
          document.querySelector('[data-import]').addEventListener('click', importFilterList)

        } else result.innerHTML = body.error

      })

      

    } else {
      result.innerHTML = `<p>Looks like that isn't a Steam Community URL? Use the format <code>https://steamcommunity.com/id/gabelogannewell</code> or <code>https://steamcommunity.com/profiles/76561197960287930</code></p>`
    }

    
  })

  function download(file, filename) {
    const link = document.createElement('a')
    link.style.display = 'none'
    link.href = file
    link.download = filename
    document.body.appendChild(link)
    link.click()
    setTimeout(() => {
      URL.revokeObjectURL(link.href)
      link.parentNode.removeChild(link)
    }, 100)
    try {
      plausible('Download', { props: { filename: filename }}) // count downloads by type
    } catch(e) { console.error (e) }
  }

  function downloadFilteredOpml(e) {
    let games = []
    document.querySelectorAll('tbody input[type="checkbox"]:checked').forEach(checkbox => {
      games.push({ name: checkbox.dataset.name, appid: checkbox.dataset.appid })
    })

    console.log(`Got ${games.length} games`)

    let opml = `<?xml version="1.0" encoding="UTF-8"?><opml version="2.0">
      <head>
        <title>Steam Updates</title>
        <dateCreated>${new Date()}</dateCreated>
        <ownerName>Zack Boehm's Steam owned games OPML generator</ownerName>
        <ownerId>https://steam-rss.zackboe.hm - https://github.com/zackboe/steam-rss</ownerId>
      </head>
      <body>
        <outline text="Steam Updates">`
      opml += games.map(game => `
          <outline text="${game.name.replace('&', '&amp;')}" title="${game.name.replace('&', '&amp;')}" type="rss" xmlUrl="https://store.steampowered.com/feeds/news/app/${game.appid}/" htmlUrl="https://store.steampowered.com/news/app/${game.appid}/"/>`
      ).join('')
      opml += `
        </outline>
      </body>
      </opml>
    `
    
    download(`data:text/xml;charset=utf-8,${encodeURIComponent(opml)}`, 'steam-updates-filtered.opml')

  }

  function exportFilterList() {
    let games = []
    document.querySelectorAll('tbody input[type="checkbox"]:not(:checked)').forEach(checkbox => {
      games.push({ name: checkbox.dataset.name, appid: checkbox.dataset.appid })
    })

    console.log(`Got ${games.length} games`)

    let file = {
      about: 'This file is a list of Steam games to be excluded when imported back into https://steam-rss.zackboe.hm',
      saved: { human: new Date().toLocaleString(), machine: Date.now() },
      exclude: games
    }

    download(`data:application/json;charset=utf-8,${JSON.stringify(file)}`, 'steam-rss-filters.json')
  }

  function importFilterList() {
    let input = document.createElement('input')
    input.type = 'file'
    input.accept = 'application/json'
    input.onchange = _ => {

      let file = Array.from(input.files)[0]
      console.log(file)
      if (file.type && !file.type.startsWith('application/json')) {
        alert("Sorry, that doesn't look like an exported file. Look for a .json file, probably named 'steam-rss-filters.json'")
        return;
      }

      const reader = new FileReader();
      reader.addEventListener('load', (event) => {
        try {
          const imported = JSON.parse(event.target.result)
          if(!imported.about) throw new Error('wrong file')
          applyImportedList(imported)
        } catch(e) {
          alert("Sorry, couldn't read that file :(")
        }
      });
      reader.readAsText(file);
    }
    input.click()
  }

  function applyImportedList(imported) {
    imported.exclude.forEach(game => {
      const app = document.querySelector(`tr[data-appid="${game.appid}"]`)
      app.querySelector('input[type="checkbox"]').checked = false
      app.querySelector('input[type="checkbox"]').parentElement.dataset.sort = "0"

    })
    document.querySelector('[data-generate] span').innerText = document.querySelectorAll('tbody input[type="checkbox"]:not(:checked)').length
    setTimeout(() => {
      alert(`Imported and applied ${imported.exclude.length} game exclusions from ${imported.saved.human}`)
    }, 500)

  }

  function checkAll() {
    document.querySelectorAll('tbody input[type="checkbox"]').forEach(check => {
      check.checked = true
      check.parentElement.dataset.sort = "0"
    })
    document.querySelector('[data-generate] span').innerText = document.querySelectorAll('tbody input[type="checkbox"]:not(:checked)').length
  }

  function uncheckAll() {
    document.querySelectorAll('tbody input[type="checkbox"]').forEach(check => {
      check.checked = false
      check.parentElement.dataset.sort = "1"
    })
    document.querySelector('[data-generate] span').innerText = document.querySelectorAll('tbody input[type="checkbox"]:not(:checked)').length
  }



</script>
</body>
</html>